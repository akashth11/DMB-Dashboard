<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Blue Tokai Coffee Digital Menu Board Dashboard - Real-time monitoring and management of signage devices">
    <meta name="keywords" content="digital signage, menu board, dashboard, Blue Tokai Coffee">
    <title>BTC DMB Dashboard | Blue Tokai Coffee Digital Menu Board</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f172a">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Stylesheet -->
    <link rel="stylesheet" href="styles.css?v=1.1">
</head>

<body>
    <!-- Error Handler -->
    <script>
        window.onerror = function (msg, url, line, col, error) {
            const loadingText = document.querySelector('#loading-screen p');
            if (loadingText) {
                loadingText.innerHTML = `Error: ${msg}<br><small>${url}:${line}</small>`;
                loadingText.style.color = 'var(--error)';
            }
            return false;
        };
        // Also catch unhandled promise rejections
        window.onunhandledrejection = function (event) {
            const loadingText = document.querySelector('#loading-screen p');
            if (loadingText) {
                loadingText.innerHTML = `Promise Error: ${event.reason}`;
                loadingText.style.color = 'var(--error)';
            }
        };
    </script>

    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p>Connecting to Firebase...</p>
    </div>

    <!-- Login Overlay -->
    <div id="login-overlay" class="login-overlay">
        <div class="login-card">
            <div class="login-header">
                <div class="logo">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 8h1a4 4 0 0 1 0 8h-1"></path>
                        <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path>
                        <line x1="6" y1="1" x2="6" y2="4"></line>
                        <line x1="10" y1="1" x2="10" y2="4"></line>
                        <line x1="14" y1="1" x2="14" y2="4"></line>
                    </svg>
                    <div class="logo-text">
                        <h1>Blue Tokai</h1>
                        <span>Dashboard</span>
                    </div>
                </div>
                <p>Sign in to access the dashboard</p>
            </div>
            <div class="login-body">
                <div id="login-form">
                    <div class="input-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" placeholder="name@example.com" required>
                    </div>
                    <button id="login-btn" class="login-btn">
                        <span>Send Login Link</span>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                    <p id="login-message" class="login-message"></p>
                </div>
                <div id="login-success" class="login-success" style="display: none;">
                    <div class="success-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M22 2L11 13"></path>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </div>
                    <h3>Check your email</h3>
                    <p>We've sent a login link to <strong id="sent-email"></strong></p>
                    <button id="back-to-login" class="text-btn">Use a different email</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar Overlay for Mobile -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <!-- Main Container -->
    <div id="app" class="app-container" style="display: none;">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M18 8h1a4 4 0 0 1 0 8h-1" />
                            <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z" />
                            <line x1="6" y1="1" x2="6" y2="4" />
                            <line x1="10" y1="1" x2="10" y2="4" />
                            <line x1="14" y1="1" x2="14" y2="4" />
                        </svg>
                    </div>
                    <div class="logo-text">
                        <h1>Blue Tokai</h1>
                        <span>DASHBOARD</span>
                    </div>
                </div>

                <nav class="sidebar-nav">
                    <button class="nav-item active" data-view="overview">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path
                                d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
                        </svg>
                        <span>Overview</span>
                    </button>

                    <button class="nav-item" data-view="branches">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm3 1h6v4H7V5zm6 6H7v2h6v-2z" />
                        </svg>
                        <span>Branches</span>
                    </button>

                    <button class="nav-item" data-view="playback">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="7" width="20" height="15" rx="2" ry="2" />
                            <polyline points="17 2 12 7 7 2" />
                        </svg>
                        <span>Active Playback</span>
                    </button>

                    <button class="nav-item" data-view="devices">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M3 5a2 2 0 012-2h10a2 2 0 012 2v8a2 2 0 01-2 2h-2.22l.123.489.804.804A1 1 0 0113 18H7a1 1 0 01-.707-1.707l.804-.804L7.22 15H5a2 2 0 01-2-2V5zm5.771 7H5V5h10v7H8.771z" />
                        </svg>
                        <span>Devices</span>
                    </button>
                </nav>

                <div class="sidebar-footer">
                    <div class="theme-toggle">
                        <label class="theme-toggle-label">Theme</label>
                        <div class="theme-options">
                            <button class="theme-btn" data-theme="light" title="Light mode">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="5" />
                                    <line x1="12" y1="1" x2="12" y2="3" />
                                    <line x1="12" y1="21" x2="12" y2="23" />
                                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                                    <line x1="1" y1="12" x2="3" y2="12" />
                                    <line x1="21" y1="12" x2="23" y2="12" />
                                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
                                </svg>
                            </button>
                            <button class="theme-btn" data-theme="dark" title="Dark mode">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                                </svg>
                            </button>
                            <button class="theme-btn" data-theme="system" title="System preference">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2" />
                                    <line x1="8" y1="21" x2="16" y2="21" />
                                    <line x1="12" y1="17" x2="12" y2="21" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="connection-status">
                        <div class="status-indicator" id="connection-status"></div>
                        <span id="connection-text">Connecting...</span>
                    </div>
                </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <button class="hamburger-btn" id="hamburger-btn" aria-label="Toggle sidebar">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <div class="header-left">
                    <h2 id="view-title">Overview</h2>
                    <p id="view-subtitle">Real-time dashboard for Blue Tokai Coffee signage system</p>
                </div>
                <div class="header-right">
                    <div class="search-box">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" />
                        </svg>
                        <input type="text" id="search-input" placeholder="Search...">
                    </div>
                    <div class="last-updated">
                        <span>Last updated: <strong id="last-updated-time">--</strong></span>
                    </div>
                </div>
            </header>

            <!-- Overview View -->
            <div id="overview-view" class="view-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon branches-icon">
                            <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm3 1h6v4H7V5zm6 6H7v2h6v-2z" />
                            </svg>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Total Branches</p>
                            <h3 class="stat-value" id="stat-branches">0</h3>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon devices-icon">
                            <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M3 5a2 2 0 012-2h10a2 2 0 012 2v8a2 2 0 01-2 2h-2.22l.123.489.804.804A1 1 0 0113 18H7a1 1 0 01-.707-1.707l.804-.804L7.22 15H5a2 2 0 01-2-2V5zm5.771 7H5V5h10v7H8.771z" />
                            </svg>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Registered Devices</p>
                            <h3 class="stat-value" id="stat-devices">0</h3>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon playback-icon">
                            <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" />
                            </svg>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Active Playback</p>
                            <h3 class="stat-value" id="stat-playback">0</h3>
                        </div>
                    </div>

                    <div class="stat-card clickable-stat" data-action="show-turned-off">
                        <div class="stat-icon online-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10" />
                                <line x1="4.93" y1="4.93" x2="19.07" y2="19.07" />
                            </svg>
                        </div>
                        <div class="stat-content">
                            <p class="stat-label">Devices Turned Off</p>
                            <h3 class="stat-value" id="stat-turned-off">0</h3>
                        </div>
                    </div>
                </div>



                <div class="card">
                    <div class="card-header">
                        <h3>Recent Activity</h3>
                    </div>
                    <div class="card-body">
                        <div id="recent-activity" class="activity-list"></div>
                    </div>
                </div>
            </div>

            <!-- Branches View -->
            <div id="branches-view" class="view-content">
                <div class="view-controls">
                    <div class="filter-group">
                        <label for="pricing-filter">Filter by Pricing:</label>
                        <select id="pricing-filter">
                            <option value="all">All Versions</option>
                        </select>
                    </div>
                </div>
                <div id="branches-grid" class="branches-grid"></div>
            </div>

            <!-- Playback View -->
            <div id="playback-view" class="view-content">
                <div class="view-controls">
                    <div class="filter-group">
                        <label for="playback-status-filter">Status:</label>
                        <select id="playback-status-filter">
                            <option value="all">All</option>
                            <option value="online">Online</option>
                            <option value="offline">Offline</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="playback-category-filter">Category:</label>
                        <select id="playback-category-filter">
                            <option value="all">All Categories</option>
                            <option value="food">Food</option>
                            <option value="beverage">Beverage</option>
                            <option value="retail">Retail</option>
                            <option value="promo">Promo</option>
                        </select>
                    </div>
                    <div class="playback-stats">
                        <span class="stat-badge active">Active: <strong id="playback-count-active">0</strong></span>
                        <span class="stat-badge offline">Turned Off: <strong
                                id="playback-count-offline">0</strong></span>
                    </div>
                </div>
                <div id="playback-list" class="playback-list"></div>
            </div>

            <!-- Devices View -->
            <div id="devices-view" class="view-content">
                <div class="view-controls">
                    <div class="filter-group">
                        <label for="device-type-filter">Filter by Type:</label>
                        <select id="device-type-filter">
                            <option value="all">All Types</option>
                            <option value="TV">TV</option>
                            <option value="Mobile">Mobile</option>
                            <option value="Tablet">Tablet</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="device-status-filter">Status:</label>
                        <select id="device-status-filter">
                            <option value="all">All</option>
                            <option value="online">Online</option>
                            <option value="offline">Offline</option>
                        </select>
                    </div>
                </div>
                <div id="devices-table" class="devices-table"></div>
            </div>
        </main>
    </div>

    <!-- Device Details Modal -->
    <div id="device-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Device Details</h3>
                <button class="modal-close" onclick="closeModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Content will be injected here -->
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module" src="app.js?v=1.1"></script>
</body>

</html>